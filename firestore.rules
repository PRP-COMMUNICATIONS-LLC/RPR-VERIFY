rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // RPR-VERIFY Forensic Bridge: Allows customer intake for authorized onboarding only
    match /customer_intake/{docId} {
      allow create: if request.auth != null && request.resource.data.audit_metadata.posture == 'SENTINEL_ACTIVE';
      allow read: if request.auth != null;
    }
    // RPR-VERIFY Audit Trail: Allows audit log creation
    match /audit_logs/{docId} {
      allow create: if request.auth != null;
    }
    // RPR-VERIFY Sentinel Posture (Global Lockdown)
    // Rejects all other writes to protect the RPR-VERIFY environment.
    match /{document=**} {
      allow read: if request.auth != null;
      allow write: if false;
    }
  }
}